@if (vm$ | async; as vm) {
  @if (this.useFormControl) {
    <hsi-ui-combobox>
      <hsi-ui-editable-textbox
        [placeholder]="isMulti ? 'Select states' : 'Select a state'"
        [ngFormControl]="searchFormControl"
      ></hsi-ui-editable-textbox>
      @if (isMulti) {
        <hsi-ui-listbox
          [ngFormControl]="listboxFormControl"
          [isMultiSelect]="true"
        >
          @for (option of vm.options; track option.id) {
            <hsi-ui-listbox-option
              [value]="option.id"
              [selected]="vm.selected.includes(option.id)"
              >{{ option.displayName }}</hsi-ui-listbox-option
            >
          }
        </hsi-ui-listbox>
      } @else {
        <hsi-ui-listbox
          [ngFormControl]="listboxFormControl"
          [isMultiSelect]="false"
        >
          @for (option of vm.options; track option.id) {
            <hsi-ui-listbox-option
              [value]="option.id"
              [selected]="vm.selected === option.id"
              >{{ option.displayName }}</hsi-ui-listbox-option
            >
          }
        </hsi-ui-listbox>
      }
    </hsi-ui-combobox>
  } @else {
    <hsi-ui-combobox>
      <hsi-ui-editable-textbox
        [placeholder]="isMulti ? 'Select states' : 'Select a state'"
        (valueChanges)="onTyping($event)"
        [initialValue]="initialValue"
      ></hsi-ui-editable-textbox>
      @if (isMulti) {
        <hsi-ui-listbox
          (valueChanges)="onSelection($event)"
          [isMultiSelect]="true"
        >
          @for (option of vm.options; track option.id) {
            <hsi-ui-listbox-option
              [value]="option.id"
              [selected]="vm.selected.includes(option.id)"
              >{{ option.displayName }}</hsi-ui-listbox-option
            >
          }
        </hsi-ui-listbox>
      } @else {
        <hsi-ui-listbox
          (valueChanges)="onSelection($event)"
          [isMultiSelect]="false"
        >
          @for (option of vm.options; track option.id) {
            <hsi-ui-listbox-option
              [value]="option.id"
              [selected]="option.id === vm.selected"
              >{{ option.displayName }}</hsi-ui-listbox-option
            >
          }
        </hsi-ui-listbox>
      }
    </hsi-ui-combobox>
  }
}
